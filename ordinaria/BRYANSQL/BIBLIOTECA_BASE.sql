ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;
CREATE USER BIBLIOTECA IDENTIFIED BY 123456;
GRANT CONNECT TO BIBLIOTECA;

CREATE TABLE USUARIO (
  ID_USUARIO NUMBER PRIMARY KEY,
  NOMBRE VARCHAR2(50),
  EMAIL VARCHAR2(100),
  FECHA_ALTA DATE,
  SALDO_MULTA NUMBER(5,2)
);

INSERT INTO USUARIO VALUES (1, 'Ana Torres', 'ana@example.com', TO_DATE('2023-01-10', 'YYYY-MM-DD'), 0);
INSERT INTO USUARIO VALUES (2, 'Luis Pérez', 'luis@example.com', TO_DATE('2023-02-15', 'YYYY-MM-DD'), 2);
INSERT INTO USUARIO VALUES (3, 'Marta Díaz', 'marta@example.com', TO_DATE('2023-03-01', 'YYYY-MM-DD'), 0);


CREATE TABLE LIBRO (
  ISBN VARCHAR2(13) PRIMARY KEY,
  TITULO VARCHAR2(100),
  AUTOR VARCHAR2(100),
  GENERO VARCHAR2(50),
  FECHA_PUBLICACION DATE
);

INSERT INTO LIBRO VALUES ('9781234567890', 'El Principito', 'Antoine de Saint-Exupéry', 'Fantasía', TO_DATE('1943-04-06', 'YYYY-MM-DD'));
INSERT INTO LIBRO VALUES ('9789876543210', '1984', 'George Orwell', 'Distopía', TO_DATE('1949-06-08', 'YYYY-MM-DD'));
INSERT INTO LIBRO VALUES ('9781111111111', 'Cien Años de Soledad', 'Gabriel García Márquez', 'Realismo Mágico', TO_DATE('1967-05-30', 'YYYY-MM-DD'));


CREATE TABLE PRESTAMO (
  ID_PRESTAMO NUMBER PRIMARY KEY,
  ID_USUARIO NUMBER,
  ISBN VARCHAR2(13),
  FECHA_PRESTAMO DATE,
  FECHA_DEVOLUCION DATE,
  CONSTRAINT FK_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID_USUARIO),
  CONSTRAINT FK_LIBRO FOREIGN KEY (ISBN) REFERENCES LIBRO(ISBN)
);

INSERT INTO PRESTAMO VALUES (1, 1, '9781234567890', TO_DATE('2024-04-01', 'YYYY-MM-DD'), TO_DATE('2024-04-05', 'YYYY-MM-DD'));
INSERT INTO PRESTAMO VALUES (2, 2, '9789876543210', TO_DATE('2024-04-01', 'YYYY-MM-DD'), TO_DATE('2024-04-10', 'YYYY-MM-DD'));
INSERT INTO PRESTAMO VALUES (3, 3, '9781111111111', TO_DATE('2024-04-01', 'YYYY-MM-DD'), NULL);


CREATE TABLE DEVOLUCION (
  ID_DEVOLUCION NUMBER PRIMARY KEY,
  ID_PRESTAMO NUMBER,
  FECHA_DEVOLUCION DATE,
  OBSERVACIONES VARCHAR2(200),
  CONSTRAINT FK_DEVOLUCION_PRESTAMO FOREIGN KEY (ID_PRESTAMO) REFERENCES PRESTAMO(ID_PRESTAMO)
);

INSERT INTO DEVOLUCION VALUES (1, 1, TO_DATE('2024-04-05', 'YYYY-MM-DD'), 'Devuelto a tiempo');
INSERT INTO DEVOLUCION VALUES (2, 2, TO_DATE('2024-04-10', 'YYYY-MM-DD'), 'Con retraso leve');